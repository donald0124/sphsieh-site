---
import Layout from '../layouts/Layout.astro';
import { getCollection } from 'astro:content';

// 取得最新的 3 篇文章
const posts = (await getCollection('posts'))
  .sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf())
  .slice(0, 3);

// 取得 1 個精選專案 (例如 MednewsDrop)
const featuredProjects = (await getCollection('projects'))
  .filter(p => p.data.title === 'MednewsDrop') // 替換成你真實的專案標題
  .slice(0, 1);
---

<Layout title="Home">
	<section class="hero-section">
		<h1>Bridging Medicine & Code.</h1>
		<p class="subtitle">
			我是 Po Hsieh (謝士博)。<br>
			白天是住院醫師，晚上是開發者。<br>
			致力於透過自動化與數位工具，解決臨床資訊的效率問題。
		</p>
	</section>

	<section class="section-group">
		<div class="section-title">
			Recent Writings
			<a href="/blog" class="view-all">View All →</a>
		</div>
		<ul class="post-list">
			{posts.map((post) => (
				<li>
					<a href={`/blog/${post.slug}`} class="post-link">
						<span class="post-date">
							{post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
						</span>
						<span class="post-title">{post.data.title}</span>
                        <div class="tag-group">
                            {post.data.tags.slice(0, 2).map((tag) => (
                                <span class="post-badge">{tag}</span>
                            ))}
                        </div>
					</a>
				</li>
			))}
		</ul>
	</section>

	{featuredProjects.length > 0 && (
        <section class="section-group">
            <div class="section-title">Featured Project</div>
            {featuredProjects.map(project => (
                <div class="project-card">
                    <h3>{project.data.title}</h3>
                    <p class="project-tech">{project.data.techStack.join(' · ')}</p>
                    <p>自動化醫學資訊訂閱系統，讓忙碌的臨床醫師不再遺漏重要期刊更新。</p>
                    <a href={`/projects/${project.slug}`}>Read Case Study →</a>
                </div>
            ))}
        </section>
    )}

</Layout>

<style>
	.hero-section {
		padding: 4rem 0 6rem 0;
	}
	h1 {
		font-size: 2.5rem;
		font-weight: 800;
		margin-bottom: 1rem;
		letter-spacing: -1px;
	}
	.subtitle {
		font-size: 1.1rem;
		color: var(--text-muted);
		line-height: 1.8;
	}

	.section-group {
		margin-bottom: 4rem;
	}
	.view-all {
		font-size: 0.9rem;
		font-weight: normal;
		color: var(--text-muted);
	}

	/* Post List Styling (Minimalist) */
	.post-list {
		list-style: none;
		padding: 0;
	}
	.post-list li {
		border-bottom: 1px solid var(--border-color);
	}
	.post-link {
		display: flex;
		align-items: baseline;
		padding: 1rem 0;
		gap: 2rem;
	}
    .post-link:hover .post-title {
        color: var(--accent);
    }
	.post-date {
		font-family: var(--font-mono);
		font-size: 0.85rem;
		color: var(--text-muted);
		min-width: 100px;
	}
	.post-title {
		font-weight: 500;
        flex-grow: 1;
	}

    .tag-group {
    display: flex;
    gap: 0.5rem;
    }

    .post-badge {
        font-size: 0.7rem;
        padding: 2px 8px;
        border-radius: 12px;
        background: var(--card-bg);
        border: 1px solid var(--border-color);
        color: var(--text-muted);
        font-weight: 500;
    }
    .post-badge.medical { background: #ebf8ff; color: #2b6cb0; }
    .post-badge.tech { background: #f0fff4; color: #276749; }
    
    /* Dark mode adjustments via global classes if needed, 
       but simplified via CSS variables */
    :global(.dark) .post-badge.medical { background: #1a365d; color: #90cdf4; }
    :global(.dark) .post-badge.tech { background: #1c4532; color: #9ae6b4; }

    /* Project Card */
    .project-card {
        background: var(--card-bg);
        padding: 2rem;
        border-radius: 12px;
    }
    .project-tech {
        font-family: var(--font-mono);
        font-size: 0.8rem;
        color: var(--text-muted);
        margin-bottom: 1rem;
    }
    
    /* RWD */
    @media (max-width: 600px) {
        .post-link { flex-direction: column; gap: 0.5rem; }
    }
</style>