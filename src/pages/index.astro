---
import Layout from "../layouts/Layout.astro";
import ThemeToggle from "../components/ThemeToggle.astro";
import { getCollection } from "astro:content";

// Fetch posts (we can filter for latest later)
const posts = (await getCollection("posts"))
    .sort(
        (a, b) =>
            b.data.publishedDate.valueOf() - a.data.publishedDate.valueOf(),
    )
    .slice(0, 3); // Top 3

// In a real scenario, we would fetch projects from collection, but for migration
// we might keep the hardcoded ones temporarily OR migrate them now.
// Given the task is to "Refactor index.astro", I will keep the *content* mostly as is
// but restructure the HTML/CSS to match the new system.
// I will also show how to use the 'projects' collection if there were any items.
const projects = await getCollection("projects");
---

<Layout title="Po Hsieh - é†«ç™‚ç§‘æŠ€è§£æ±ºæ–¹æ¡ˆ">
    <!-- Navigation Bar -->
    <nav class="navbar">
        <div class="container nav-container">
            <a href="#" class="nav-logo">
                Po Hsieh<span style="color:var(--color-secondary);">.</span>
            </a>

            <div class="nav-links">
                <a href="#about" class="nav-link">é—œæ–¼æˆ‘</a>
                <a href="#projects" class="nav-link">ç²¾é¸å°ˆæ¡ˆ</a>
                <a href="/blog" class="nav-link">éƒ¨è½æ ¼</a>
                <a href="#contact" class="nav-btn">èˆ‡æˆ‘è¯ç¹«</a>
                <div style="margin-left: 1rem;">
                    <ThemeToggle />
                </div>
            </div>

            <!-- Mobile Toggle placeholder (functionality to be added if asked, for now basic) -->
            <div class="mobile-menu-btn" style="display:none;">Menu</div>
        </div>
    </nav>

    <header class="hero-section">
        <div class="hero-bg-decoration"></div>
        <div class="container hero-content">
            <div class="hero-text-area">
                <div class="tag-group">
                    <span class="tag-badge">ğŸ©º é†«å®˜ / é†«å¸«</span>
                    <span class="tag-badge">ğŸ’» å…¨ç«¯é–‹ç™¼è€…</span>
                    <span class="tag-badge">ğŸ¤– AI Agent</span>
                </div>
                <h1 class="hero-title">Po Hsieh è¬å£«åš</h1>
                <p class="hero-subtitle">
                    é€£çµé†«ç™‚èˆ‡ç§‘æŠ€çš„æ©‹æ¨‘ã€‚<br />
                    ä½é™¢é†«å¸« / é†«å®˜ / å…¨ç«¯é–‹ç™¼è€…ã€‚
                </p>
                <div class="hero-actions">
                    <a href="#projects" class="btn">æŸ¥çœ‹å°ˆæ¡ˆæˆæœ</a>
                    <a href="#contact" class="btn btn-outline">ç´¢å–è©³ç´°å±¥æ­·</a>
                </div>
            </div>
        </div>
    </header>

    <section id="projects" class="section-block">
        <div class="container">
            <h2 class="section-title">éå¾€å°ˆæ¡ˆç¶“é©—</h2>

            <div class="projects-grid">
                <!-- Hardcoded migration content to ensure site looks same/better immediately -->
                <!-- Ideally these move to the CMS later -->

                <article class="project-card">
                    <div class="project-image-box">
                        <img
                            src="/clinic-LineOA.jpg"
                            alt="Line OA"
                            loading="lazy"
                        />
                    </div>
                    <div class="project-info-box">
                        <span class="project-category">Line OA + AI</span>
                        <h3 class="project-title">
                            è¨ºæ‰€ LINE å®˜æ–¹å¸³è™Ÿ AI å®¢æœ
                        </h3>
                        <p class="project-desc">
                            å®Œæ•´å»ºç½®å®˜æ–¹å¸³è™Ÿï¼Œä¸¦æ•´åˆ AI Chatbot
                            é€²è¡Œåˆæ­¥åˆ†æµèˆ‡å•ç­”ã€‚ æä¾›ç—…æ‚£ 24/7
                            çš„å³æ™‚å›æ‡‰ï¼Œæ¸›è¼•æ«ƒæª¯è¡Œæ”¿è² æ“”ã€‚
                        </p>
                        <a
                            href="https://line.me/R/ti/p/@gsj9393s"
                            target="_blank"
                            class="btn-outline"
                            style="align-self: flex-start; padding: 6px 16px; border-radius: 99px; font-size: 0.85rem;"
                            >åŠ å…¥å¥½å‹é«”é©—</a
                        >
                    </div>
                </article>

                <article class="project-card">
                    <div class="project-image-box">
                        <img
                            src="/clinic-website.jpg"
                            alt="Clinic Website"
                            loading="lazy"
                        />
                    </div>
                    <div class="project-info-box">
                        <span class="project-category">Web Dev</span>
                        <h3 class="project-title">è¨ºæ‰€å½¢è±¡å®˜æ–¹ç¶²ç«™</h3>
                        <p class="project-desc">
                            æ‰“é€ é«˜é€Ÿéœæ…‹ç¶²ç«™ (Astro)ã€‚å„ªåŒ– SEO
                            æ¶æ§‹ï¼Œç¢ºä¿æœå°‹ç²¾æº–å°æµã€‚ æ•´åˆ Google Maps
                            èˆ‡é–€è¨ºè³‡è¨Šï¼Œä¸¦å»ºç½®è¡›æ•™æ–‡ç« å°ˆå€ã€‚
                        </p>
                        <a
                            href="https://drhsieh-rehab.com"
                            target="_blank"
                            class="btn-outline"
                            style="align-self: flex-start; padding: 6px 16px; border-radius: 99px; font-size: 0.85rem;"
                            >ç€è¦½ç¶²ç«™</a
                        >
                    </div>
                </article>

                <article class="project-card">
                    <div class="project-image-box">
                        <div
                            style="width:100%; height:100%; background: #eee; display:flex; align-items:center; justify-content:center; color:#999;"
                        >
                            MednewsDrop
                        </div>
                    </div>
                    <div class="project-info-box">
                        <span class="project-category">AI & Automation</span>
                        <h3 class="project-title">MednewsDrop</h3>
                        <p class="project-desc">
                            çµåˆ LLM çš„è‡ªå‹•åŒ–å·¥å…·ã€‚ç³»çµ±è‡ªå‹•å®šæœŸæŠ“å– PubMed
                            ä¸Šçš„æœ€æ–°é†«å­¸è«–æ–‡ï¼Œç”Ÿæˆç²¾ç°¡æ‘˜è¦ä¸¦å¯„é€é›»å­å ±ï¼Œå¹«åŠ©é†«å¸«æŒæ¡æœ€æ–°å¯¦è­‰é†«å­¸ã€‚
                        </p>
                        <a
                            href="https://mednewsdrop.com"
                            target="_blank"
                            class="btn-outline"
                            style="align-self: flex-start; padding: 6px 16px; border-radius: 99px; font-size: 0.85rem;"
                            >æŸ¥çœ‹æœå‹™</a
                        >
                    </div>
                </article>

                <article class="project-card">
                    <div class="project-image-box">
                        <img
                            src="/choice-system.gif"
                            alt="Selection System"
                            loading="lazy"
                        />
                    </div>
                    <div class="project-info-box">
                        <span class="project-category"
                            >System Logic / React</span
                        >
                        <h3 class="project-title">ä½é™¢é†«å¸«é¸ç§‘é æ’ç³»çµ±</h3>
                        <p class="project-desc">
                            è§£æ±ºè¤‡é›œçš„äººåŠ›åˆ†é…èˆ‡å¿—é¡˜æ’åºé‚è¼¯ã€‚æä¾›ç›´è§€çš„æ‹–æ”¾ä»‹é¢
                            (Drag & Drop)ï¼Œæ¨¡æ“¬å¯¦éš›é¸ç§‘ä½œæ¥­ï¼Œå„ªåŒ–åˆ†ç™¼æµç¨‹ã€‚
                        </p>
                    </div>
                </article>

                <!-- Dynamic Projects from CMS would go here -->
                {
                    projects.map((p) => (
                        <article class="project-card">
                            <div class="project-image-box">
                                {p.data.image ? (
                                    <img
                                        src={p.data.image}
                                        alt={p.data.title}
                                    />
                                ) : (
                                    <div style="padding:20px;">No Image</div>
                                )}
                            </div>
                            <div class="project-info-box">
                                <span class="project-category">
                                    {p.data.category}
                                </span>
                                <h3 class="project-title">{p.data.title}</h3>
                                <p class="project-desc">{p.data.description}</p>
                                {p.data.demoLink && (
                                    <a
                                        href={p.data.demoLink}
                                        target="_blank"
                                        class="btn-outline"
                                        style="align-self: flex-start; padding: 6px 16px; border-radius: 99px; font-size: 0.85rem;"
                                    >
                                        Demo
                                    </a>
                                )}
                            </div>
                        </article>
                    ))
                }
            </div>
        </div>
    </section>

    <!-- Latest Writing Section -->
    <section
        class="section-block"
        style="background-color: var(--color-bg-card);"
    >
        <div class="container">
            <h2 class="section-title">æœ€æ–°æ–‡ç« </h2>
            <div class="posts-grid-home">
                {
                    posts.map((post) => (
                        <a href={`/blog/${post.slug}`} class="home-post-card">
                            <span
                                class="post-cat-tag"
                                data-cat={post.data.category}
                            >
                                {post.data.category}
                            </span>
                            <h3>{post.data.title}</h3>
                            <time>
                                {post.data.publishedDate.toLocaleDateString()}
                            </time>
                        </a>
                    ))
                }
                {
                    posts.length === 0 && (
                        <p style="text-align:center;color:var(--color-text-light);">
                            ç›®å‰å°šç„¡æ–‡ç« ã€‚
                        </p>
                    )
                }
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <a href="/blog" class="btn-outline" style="border-radius: 99px;"
                    >æŸ¥çœ‹æ‰€æœ‰æ–‡ç« </a
                >
            </div>
        </div>
    </section>

    <section id="competencies" class="section-block">
        <div class="container">
            <h2 class="section-title">æ ¸å¿ƒç«¶çˆ­åŠ›</h2>
            <div class="proposal-grid">
                <div class="proposal-card">
                    <h3>ğŸ©º é†«ç™‚èˆ‡ç§‘æŠ€çš„æ©‹æ¨‘</h3>
                    <p>
                        ä¸åƒ…æ˜¯å·¥ç¨‹å¸«ï¼Œæ›´æ˜¯è‡¨åºŠé†«å¸«ã€‚æˆ‘æ·±åˆ»ç†è§£é†«ç™‚ç¾å ´çš„ç—›é»ã€æ³•è¦é™åˆ¶èˆ‡é†«ç—…é—œä¿‚ï¼Œèƒ½é–‹ç™¼å‡ºçœŸæ­£åˆ‡ä¸­é†«ç™‚äººå“¡éœ€æ±‚çš„æ•¸ä½å·¥å…·ã€‚
                    </p>
                </div>

                <div class="proposal-card">
                    <h3>âš¡ è‡ªå‹•åŒ–å·¥ä½œæµå°ˆå®¶</h3>
                    <p>
                        æ“…é•·ä½¿ç”¨ n8nã€Python èˆ‡ LLM
                        æŠ€è¡“ï¼Œå°‡ç¹ç‘£çš„è¡Œæ”¿æµç¨‹ï¼ˆå¦‚ç—…æ­·æ‘˜è¦ã€ç¤¾ç¾¤ç™¼æ–‡ã€é¸ç§‘æ’ç¨‹ï¼‰è‡ªå‹•åŒ–ï¼Œé‡‹æ”¾å¯¶è²´çš„è‡¨åºŠæ™‚é–“ã€‚
                    </p>
                </div>
            </div>
        </div>
    </section>

    <section id="contact" class="container" style="margin-bottom: 60px;">
        <div class="model-section">
            <h2 class="section-title" style="color:white;">èˆ‡æˆ‘è¯ç¹«</h2>
            <p
                style="text-align: center; max-width: 600px; margin: 0 auto 30px auto; color: #e2e8f0;"
            >
                ç„¡è«–æ˜¯é†«ç™‚è³‡è¨Šç³»çµ±é–‹ç™¼ã€è‡ªå‹•åŒ–æµç¨‹è«®è©¢ï¼Œæˆ–æ˜¯å–®ç´”çš„æŠ€è¡“äº¤æµï¼Œéƒ½æ­¡è¿éš¨æ™‚èˆ‡æˆ‘è¯ç¹«ã€‚
            </p>

            <div
                style="display: flex; gap: 20px; justify-content: center; flex-wrap: wrap;"
            >
                <a
                    href="mailto:donald0124@gmail.com"
                    class="btn"
                    style="background-color: white; color: var(--color-primary);"
                >
                    donald0124@gmail.com
                </a>
                <a
                    href="https://github.com/donald0124"
                    target="_blank"
                    class="btn-outline"
                    style="border-color: white; color: white;"
                >
                    GitHub
                </a>
            </div>
        </div>
    </section>

    <footer class="site-footer">
        <div class="container">
            <p>Â© 2025 Po Hsieh | é†«å¸« & é–‹ç™¼è€…</p>
        </div>
    </footer>
</Layout>

<style>
    /* 
       Most styles are now in global.css to support theming 
       Page specific styles here 
    */

    /* HERO */
    .hero-section {
        min-height: 85vh;
        display: flex;
        align-items: center;
        /* Background is handled by global --color-bg */
        position: relative;
        overflow: hidden;
    }

    .hero-bg-decoration {
        position: absolute;
        top: -10%;
        right: -10%;
        width: 400px;
        height: 400px;
        background: radial-gradient(
            circle,
            var(--color-accent) 0%,
            transparent 70%
        );
        opacity: 0.15;
        border-radius: 50%;
        filter: blur(60px);
        z-index: 0;
    }

    .hero-content {
        position: relative;
        z-index: 1;
        display: flex;
        flex-direction: column;
        justify-content: center;
        height: 100%;
    }

    .hero-text-area {
        max-width: 800px;
    }

    .tag-group {
        display: flex;
        gap: 12px;
        flex-wrap: wrap;
        margin-bottom: 24px;
    }

    .tag-badge {
        background: var(--color-bg-card);
        color: var(--color-secondary);
        border: 1px solid var(--color-border);
        padding: 6px 16px;
        border-radius: 99px;
        font-size: 0.85rem;
        font-weight: 700;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
    }

    .hero-title {
        font-size: 3rem;
        font-weight: 900;
        margin-bottom: 24px;
        letter-spacing: -0.05em;
    }

    .hero-subtitle {
        font-size: 1.25rem;
        color: var(--color-text-light);
        margin-bottom: 40px;
        max-width: 600px;
    }

    .hero-actions {
        display: flex;
        gap: 16px;
        flex-wrap: wrap;
    }

    /* Navbar additions */
    .navbar {
        position: fixed;
        width: 100%;
        z-index: 1000;
        top: 0;
        background: rgba(255, 255, 255, 0.1); /* Glass effect base */
        backdrop-filter: blur(12px);
        -webkit-backdrop-filter: blur(12px);
        border-bottom: 1px solid var(--color-border);
        padding: 1rem 0;
    }
    :global([data-theme="dark"]) .navbar {
        background: rgba(13, 17, 23, 0.7);
    }

    .nav-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
    }
    .nav-logo {
        font-weight: 800;
        font-size: 1.25rem;
        color: var(--color-primary);
    }
    .nav-links {
        display: none; /* Mobile hidden by default */
        align-items: center;
        gap: 2rem;
    }
    @media (min-width: 768px) {
        .nav-links {
            display: flex;
        }
    }
    .nav-link {
        font-weight: 500;
        font-size: 0.95rem;
        opacity: 0.8;
    }
    .nav-link:hover {
        opacity: 1;
        color: var(--color-secondary);
    }

    /* PROJECTS GRID */
    .projects-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
    }
    @media (min-width: 768px) {
        .projects-grid {
            grid-template-columns: 1fr 1fr;
        }
    }

    .project-card {
        background: var(--color-bg-card);
        border-radius: var(--radius-card); /* defined in root? Use fallback */
        border-radius: 16px;
        overflow: hidden;
        box-shadow: var(--shadow-card);
        display: flex;
        flex-direction: column;
        border: 1px solid var(--color-border);
        transition:
            transform 0.2s,
            box-shadow 0.2s;
    }
    .project-card:hover {
        transform: translateY(-4px);
        box-shadow: var(--shadow-hover);
    }

    .project-image-box {
        width: 100%;
        height: 200px;
        background: #f1f5f9;
        overflow: hidden;
    }
    .project-image-box img {
        width: 100%;
        height: 100%;
        object-fit: cover;
    }

    .project-info-box {
        padding: 24px;
        flex: 1;
        display: flex;
        flex-direction: column;
    }

    .project-category {
        color: var(--color-secondary);
        font-size: 0.75rem;
        font-weight: 800;
        text-transform: uppercase;
        margin-bottom: 12px;
        letter-spacing: 0.05em;
    }

    .project-title {
        font-size: 1.25rem;
        margin-bottom: 12px;
        color: var(--color-primary);
    }

    .project-desc {
        color: var(--color-text-light);
        font-size: 0.95rem;
        margin-bottom: 20px;
        flex-grow: 1;
    }

    /* HOME POSTS */
    .posts-grid-home {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
        gap: 1.5rem;
        margin-top: 20px;
    }
    .home-post-card {
        background: var(--color-bg); /* Contrast against section bg-card */
        padding: 1.5rem;
        border-radius: 12px;
        border: 1px solid var(--color-border);
        display: block;
        transition: all 0.2s;
    }
    .home-post-card:hover {
        border-color: var(--color-secondary);
        transform: translateY(-2px);
    }
    .post-cat-tag {
        font-size: 0.75rem;
        font-weight: 700;
        text-transform: uppercase;
        margin-bottom: 0.5rem;
        display: inline-block;
        padding: 2px 8px;
        border-radius: 4px;
        background: #e2e8f0;
        color: #475569;
    }
    .home-post-card h3 {
        font-size: 1.1rem;
        margin-bottom: 0.5rem;
    }
    .home-post-card time {
        font-size: 0.85rem;
        color: var(--color-text-light);
    }

    /* PROPOSALS */
    .proposal-grid {
        display: grid;
        grid-template-columns: 1fr;
        gap: 2rem;
    }
    @media (min-width: 768px) {
        .proposal-grid {
            grid-template-columns: 1fr 1fr;
        }
    }
    .proposal-card {
        background: var(--color-bg-card);
        padding: 2rem;
        border-radius: 16px;
        border: 1px solid var(--color-border);
        text-align: center;
    }
    .proposal-card h3 {
        margin-bottom: 1rem;
        font-size: 1.25rem;
    }
    .proposal-card p {
        color: var(--color-text-light);
    }

    /* MODEL SECTION */
    .model-section {
        background: linear-gradient(135deg, var(--color-primary) 0%, #000 100%);
        padding: 4rem 2rem;
        border-radius: 20px;
        color: white;
    }

    .site-footer {
        padding: 40px 0;
        text-align: center;
        color: var(--color-text-light);
        border-top: 1px solid var(--color-border);
        font-size: 0.9rem;
    }
</style>
